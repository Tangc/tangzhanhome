# 大家好，我是唐斩，这是第75天第91篇分享。

## 1、VibeCoding 50技巧(4) 祖传代码安全重构
首先，明确是否真的要重构，我的建议是
- 非必要不重构。
 - 代码结构应该在详细设计时明确，开发期间只微调不大改。
 - 存量代码尽量不重构，衡量成本和收益，业务优先。
- 渐进式重构优于专项重构。
 - 渐进式意思是随着业务项目的改动进行，不改动的地方不重构，改动涉及的地方重构。
 - 专项重构只在十分必要的时候进行，比如性能风险(明确性能隐患时)，能力极限风险(无法扩展时)，认知负担风险(代码复杂到难以维护时)。
- 没有单元测试和CI时不重构。
 - 无验证的重构，如同让小孩拿着手枪经过闹市，纯赌命。

然后，VibeCoding 重构的流程是“限定上下文，补齐测试，量化方案，执行修改，迭代测试”
- 限定上下文，最重要的步骤，每次重构要把代码范围限制到最小，最好是在一个文件内并且是相邻的代码，最差也不能跨文件夹。如果跨太远的话，首先人工把代码调整到一起，再使用 VibeCoding 重构
- 补齐测试，涉及重构的方法和上层方法，VibeCoding 补充单元测试和集成测试，让AI把测试用例写在方法注释上
 - 注意AI生成的测试要先Review和执行一遍，只关注AI写的用例、代码、数据是否一致。用例正确才能保障重构的安全。
- 量化方案，先和AI讨论重构方案，有一个技巧是让AI给代码打分，给重构后的代码打分，通过观察分数差值来评估重构方案的价值。
- 执行修改，记得多次改动，提交git(让AI提交，commit写清楚改动内容)
- 迭代测试，再次运行测试，让AI逐个修复，此时要稍微注意下修复方案，不要把问题掩盖了。

敬畏线上代码，做好安全防护措施(AI交叉Review、专家Review、灰度发布等措施)
最后，VibeCoding 重构代码有百般风险，但整体是非常高效的，应该积极拥抱。